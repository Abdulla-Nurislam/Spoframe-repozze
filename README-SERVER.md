# Настройка сервера для Spoframe

Этот документ содержит инструкции по настройке сервера для проекта Spoframe с использованием автоматизированного скрипта.

## Требования

- Сервер с чистой установкой Ubuntu Server 20.04 LTS или более новой версии
- Доступ к серверу с правами суперпользователя (root)
- Зарегистрированный домен, который вы планируете использовать для проекта

## Подготовка к настройке

1. Загрузите скрипт `setup-server.sh` на ваш сервер:
   ```bash
   scp setup-server.sh user@your-server-ip:~/
   ```

2. Подключитесь к серверу по SSH:
   ```bash
   ssh user@your-server-ip
   ```

3. Сделайте скрипт исполняемым:
   ```bash
   chmod +x setup-server.sh
   ```

## Запуск скрипта настройки

1. Запустите скрипт с правами суперпользователя:
   ```bash
   sudo bash setup-server.sh
   ```

2. Следуйте инструкциям на экране:
   - Введите домен (например, spoframe.com)
   - Введите email для SSL-сертификата
   - Введите порт для Node.js приложения (по умолчанию 3001)

## После выполнения скрипта

После успешного выполнения скрипта вам необходимо:

1. Настроить DNS-записи вашего домена, указав их на IP-адрес сервера:
   - Создайте A-запись для домена (например, spoframe.com)
   - Создайте A-запись для поддомена www (например, www.spoframe.com)

2. После настройки DNS и проверки их работы, установите SSL-сертификат:
   ```bash
   sudo certbot --nginx -d spoframe.com -d www.spoframe.com
   ```

3. Следуйте инструкциям по развертыванию приложения, которые находятся в файле `/root/spoframe-deployment.txt`

## Проверка настройки

1. Проверьте работу Nginx:
   ```bash
   sudo systemctl status nginx
   ```

2. Проверьте конфигурацию Nginx:
   ```bash
   sudo nginx -t
   ```

3. Проверьте работу fail2ban:
   ```bash
   sudo systemctl status fail2ban
   ```

4. После развертывания приложения проверьте его доступность:
   ```bash
   curl http://localhost:3001/api/health
   ```

## Мониторинг и обслуживание

Скрипт настраивает следующие средства мониторинга и обслуживания:

1. **PM2** для управления процессами Node.js
   ```bash
   pm2 status
   pm2 monit
   ```

2. **Скрипт мониторинга**, который каждые 5 минут проверяет доступность API и потребление памяти
   ```bash
   sudo tail -f /var/log/spoframe-monitor.log
   ```

3. **Ежедневное резервное копирование** в 2 часа ночи
   ```bash
   sudo ls -la /var/backups/spoframe
   ```

4. **Автоматические обновления безопасности** для поддержания системы в актуальном состоянии

## Решение проблем

Если у вас возникли проблемы:

1. Проверьте логи Nginx:
   ```bash
   sudo tail -f /var/log/nginx/error.log
   ```

2. Проверьте логи приложения:
   ```bash
   pm2 logs
   ```

3. Проверьте логи скрипта мониторинга:
   ```bash
   sudo tail -f /var/log/spoframe-monitor.log
   ```

4. В случае необходимости перезапустите сервисы:
   ```bash
   sudo systemctl restart nginx
   pm2 restart spoframe
   ```

## Дополнительные рекомендации

1. Регулярно проверяйте работоспособность резервного копирования
2. Настройте внешний мониторинг с использованием сервисов типа UptimeRobot
3. Настройте оповещения о критических событиях на сервере
4. Периодически обновляйте операционную систему и приложение

# Инструкция по запуску сервера Spoframe

## Два режима работы

Проект Spoframe имеет два разных режима работы:

1. **React-приложение** (frontend Development):
   ```bash
   npm start
   # или
   npm run dev
   ```
   Этот режим запускает webpack-dev-server для разработки React компонентов.

2. **Node.js/Express сервер** (полноценный сайт с API):
   ```bash
   npm run server
   # или
   npm run start:server
   ```
   Этот режим запускает полноценный сервер на Node.js и Express с API и статическими HTML-страницами.

## Решение проблем

### Проблема: HTML-страницы не работают при запуске через `npm start`

Это нормальное поведение, так как `npm start` запускает webpack-dev-server, который предназначен для разработки React-компонентов, а не для обслуживания статических HTML-страниц.

### Решение:

1. Используйте `npm run server` для запуска Express-сервера, который правильно обрабатывает HTML-страницы.
2. Сервер будет доступен по адресу http://localhost:3001

### Проблема: Изображения или CSS не загружаются

Если изображения или CSS не загружаются, проверьте пути к файлам в HTML. Для правильной работы с Express сервером все пути должны начинаться со слеша (`/`).

### Решение:

Исправьте пути в HTML-файлах:
```html
<!-- Неправильно -->
<img src="image.jpg">
<link rel="stylesheet" href="style.css">

<!-- Правильно -->
<img src="/image.jpg">
<link rel="stylesheet" href="/style.css">
```

### Проблема: Ошибки 404 при переходе по ссылкам

Если получаете ошибки 404 при переходе по ссылкам, проверьте, что используете правильные URL в навигации.

### Решение:

URLs для навигации должны соответствовать настроенным в сервере маршрутам:
- `/` - главная страница
- `/catalog` - каталог
- `/product` - детальная страница продукта
- `/about` - страница о продукте

## Режим разработки

При разработке вы можете использовать два терминала:
1. Один для запуска сервера: `npm run server`
2. Другой для разработки React-компонентов: `npm start`

Это позволит вам одновременно работать с HTML-страницами и React-компонентами.

# Развертывание Spoframe

Этот документ содержит информацию о развертывании проекта Spoframe на платформе Vercel.

## Требования

- Аккаунт на [Vercel](https://vercel.com)
- Git репозиторий с проектом
- Node.js версии 14 или выше

## Развертывание на Vercel

1. Подключите ваш GitHub репозиторий к Vercel:
   - Войдите в аккаунт Vercel
   - Нажмите "Import Project"
   - Выберите ваш репозиторий

2. Настройте переменные окружения в Vercel:
   - Перейдите в настройки проекта
   - Добавьте необходимые переменные окружения:
     ```
     MONGODB_URI=your_mongodb_uri
     JWT_SECRET=your_jwt_secret
     SPOTIFY_CLIENT_ID=your_spotify_client_id
     SPOTIFY_CLIENT_SECRET=your_spotify_client_secret
     ```

3. Настройте параметры сборки:
   - Build Command: `npm run build`
   - Output Directory: `public`
   - Install Command: `npm install`

## Локальная разработка

1. Установите зависимости:
   ```bash
   npm install
   ```

2. Запустите сервер разработки:
   ```bash
   npm run server
   ```

Сервер будет доступен по адресу: `http://localhost:3000`

## Мониторинг и обслуживание

Vercel предоставляет встроенные инструменты для:

1. **Мониторинга производительности**
   - Аналитика загрузки страниц
   - Метрики Web Vitals
   - Логи ошибок

2. **Автоматического масштабирования**
   - Автоматическая балансировка нагрузки
   - Глобальная CDN сеть

3. **Безопасности**
   - Автоматические SSL-сертификаты
   - DDoS защита
   - Защита от ботов

## Решение проблем

### Проблема: Медленная загрузка страниц

1. Проверьте размер изображений
2. Убедитесь, что включено кэширование
3. Проверьте настройки сжатия в vercel.json

### Проблема: Ошибки 404

1. Проверьте правильность путей в vercel.json
2. Убедитесь, что все статические файлы находятся в правильных директориях

### Проблема: Проблемы с API

1. Проверьте логи в панели Vercel
2. Убедитесь, что все переменные окружения настроены правильно

## Рекомендации по оптимизации

1. Используйте Vercel Edge Functions для API где это возможно
2. Настройте кэширование статического контента
3. Оптимизируйте изображения перед загрузкой
4. Используйте Vercel Analytics для мониторинга производительности 